{% extends "base.html" %}
{% block title %}جميع العملاء المكتملين بالكامل{% endblock %}
{% block content %}

<div class="container mt-4">
  <div class="row">
    <div class="col-12">
      <div class="card shadow-lg border-0">
        <div class="card-header bg-success text-white">
          <div class="d-flex justify-content-between align-items-center">
            <h4 class="mb-0">
              <i class="fas fa-check-double me-2"></i>
              جميع العملاء المكتملين بالكامل (جميع المراحل)
            </h4>
            <a href="{{ url_for('disappointed_clients') }}" class="btn btn-light btn-sm">
              <i class="fas fa-arrow-right me-1"></i>
              العودة للصفحة الرئيسية
            </a>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0">
              <thead class="table-light">
                <tr>
                  <th>اسم العميل</th>
                  <th>رقم الهاتف</th>
                  <th>تاريخ العقد</th>
                  <th>المبلغ المدفوع</th>
                  <th>تاريخ الإكمال</th>
                  <th>أنشأ بواسطة</th>
                  <th>الإجراءات</th>
                </tr>
              </thead>
              <tbody>
                {% if clients %}
                  {% for client in clients %}
                  <tr>
                    <td>
                      <a href="{{ url_for('fully_completed_client_details', client_id=client.id) }}" 
                         class="text-decoration-none fw-bold text-success">
                        {{ client.client_name }}
                      </a>
                    </td>
                    <td>{{ client.client_phone }}</td>
                    <td>{{ client.contract_date.strftime('%Y-%m-%d') if client.contract_date else 'غير محدد' }}</td>
                    <td>{{ client.paid_amount or 'غير محدد' }}</td>
                    <td>{{ client.completion_date.strftime('%Y-%m-%d') if client.completion_date else 'غير محدد' }}</td>
                    <td>
                      <span class="badge bg-success">
                        {{ client.created_by or 'غير محدد' }}
                      </span>
                    </td>
                    <td>
                      <a href="{{ url_for('fully_completed_client_details', client_id=client.id) }}" 
                         class="btn btn-success btn-sm">
                        <i class="fas fa-eye me-1"></i>
                        عرض التفاصيل
                      </a>
                    </td>
                  </tr>
                  {% endfor %}
                {% else %}
                  <tr>
                    <td colspan="7" class="text-center py-5 text-muted">
                      <i class="fas fa-check-double fa-3x mb-3 text-success"></i>
                      <br>
                      <h5>لا يوجد عملاء مكتملين بالكامل بعد</h5>
                      <p class="mb-0">ابدأ بإضافة عملاء في إدارة الملفات</p>
                    </td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- إحصائيات سريعة -->
{% if clients %}
<div class="container mt-4">
  <div class="row">
    <div class="col-md-3">
      <div class="card bg-primary text-white">
        <div class="card-body text-center">
          <h3 class="mb-1">{{ clients|length }}</h3>
          <p class="mb-0">إجمالي العملاء المكتملين</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-success text-white">
        <div class="card-body text-center">
          <h3 class="mb-1">
            {{ clients|selectattr('legal_created_by')|list|length }}
          </h3>
          <p class="mb-0">مكتملين في جميع المراحل</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-warning text-white">
        <div class="card-body text-center">
          <h3 class="mb-1">
            {{ clients|selectattr('followup_created_by')|rejectattr('legal_created_by')|list|length }}
          </h3>
          <p class="mb-0">مكتملين حتى المتابعة</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="card bg-info text-white">
        <div class="card-body text-center">
          <h3 class="mb-1">
            {{ clients|rejectattr('followup_created_by')|list|length }}
          </h3>
          <p class="mb-0">مكتملين في إدارة الملفات فقط</p>
        </div>
      </div>
    </div>
  </div>
</div>
{% endif %}

<style>
.table th {
  font-size: 0.9rem;
  font-weight: 600;
  border-top: none;
  background-color: #f8f9fa;
}

.table td {
  font-size: 0.85rem;
  vertical-align: middle;
}

.card {
  border-radius: 10px;
}

.card-header {
  border-radius: 10px 10px 0 0 !important;
  border: none;
}

.table-responsive {
  max-height: 600px;
  overflow-y: auto;
}

.btn {
  border-radius: 6px;
}

.badge {
  font-size: 0.75rem;
}
</style>

{% endblock %}
