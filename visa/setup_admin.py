#!/usr/bin/env python3
"""
Ø³ÙƒØ±ÙŠØ¨Øª Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
"""
import os
import sys
from dotenv import load_dotenv

# Ø¥Ø¶Ø§ÙØ© Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
sys.path.append(os.path.dirname(os.path.abspath(__file__)))

from app import app, db, User

def setup_admin_user():
    """Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ±"""
    with app.app_context():
        try:
            # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ±
            admin_user = User.query.filter_by(username='admin').first()
            
            if admin_user:
                print(f"âœ… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„ÙØ¹Ù„:")
                print(f"   - Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {admin_user.username}")
                print(f"   - Ø§Ø³Ù… Ø§Ù„Ù…ÙˆØ¸Ù: {admin_user.employee_name}")
                print(f"   - Ø§Ù„Ø¯ÙˆØ±: {admin_user.role}")
                print(f"   - Ù†Ø´Ø·: {admin_user.is_active}")
                
                # Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¯ÙˆØ± Ù‡Ùˆ admin
                if admin_user.role != 'admin':
                    admin_user.role = 'admin'
                    db.session.commit()
                    print("âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¯ÙˆØ± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¥Ù„Ù‰ admin")
            else:
                print("âŒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ± ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¤Ù‡...")
                
                # Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯
                admin_user = User(
                    employee_name='Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…',
                    username='admin',
                    password='admin123',  # ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø¨Ø³ÙŠØ·Ø© Ù„Ù„Ø¨Ø¯Ø§ÙŠØ©
                    role='admin',
                    is_active=True
                )
                
                db.session.add(admin_user)
                db.session.commit()
                
                print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­:")
                print(f"   - Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: admin")
                print(f"   - ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: admin123")
                print(f"   - Ø§Ù„Ø¯ÙˆØ±: admin")
                
        except Exception as e:
            print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ±: {e}")
            db.session.rollback()

def list_all_users():
    """Ø¹Ø±Ø¶ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†"""
    with app.app_context():
        try:
            users = User.query.all()
            if users:
                print(f"\nğŸ“‹ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ({len(users)} Ù…Ø³ØªØ®Ø¯Ù…):")
                print("-" * 60)
                for user in users:
                    status = "Ù†Ø´Ø·" if user.is_active else "ØºÙŠØ± Ù†Ø´Ø·"
                    print(f"ID: {user.id} | Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: {user.username} | Ø§Ù„Ù…ÙˆØ¸Ù: {user.employee_name} | Ø§Ù„Ø¯ÙˆØ±: {user.role} | Ø§Ù„Ø­Ø§Ù„Ø©: {status}")
            else:
                print("âŒ Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙÙŠ Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª")
        except Exception as e:
            print(f"âŒ Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†: {e}")

if __name__ == "__main__":
    load_dotenv()
    
    print("ğŸ”§ Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø¯ÙŠØ±...")
    print("=" * 50)
    
    setup_admin_user()
    list_all_users()
    
    print("\n" + "=" * 50)
    print("ğŸ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯!")
    print("ğŸ’¡ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù…:")
    print("   - Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…: admin")
    print("   - ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±: admin123")
